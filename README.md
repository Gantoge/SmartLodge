# üè® MIPHI Microservices Demo ‚Äî –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª–µ–π

**MIPHI Microservices Demo** ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–Ω–æ–≥–æ–º–æ–¥—É–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ **Spring Boot / Spring Cloud**, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π —Å–∏—Å—Ç–µ–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –æ—Ç–µ–ª–µ–π.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü–æ—Ä—Ç |
|--------|-------------|------|
| **eureka-server** | –†–µ–µ—Å—Ç—Ä —Å–µ—Ä–≤–∏—Å–æ–≤ | `8761` |
| **api-gateway** | API-—à–ª—é–∑ (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è) | `8080` |
| **hotel-service** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–µ–ª—è–º–∏ –∏ –Ω–æ–º–µ—Ä–∞–º–∏ | —Å–ª—É—á–∞–π–Ω—ã–π (`0`), —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ Eureka |
| **booking-service** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | —Å–ª—É—á–∞–π–Ω—ã–π (`0`), —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ Eureka |

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **H2**.  
–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –Ω–∏–º–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö).

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (JWT, —á–µ—Ä–µ–∑ `Booking Service`)
- üè∑Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –¥–≤—É—Ö—à–∞–≥–æ–≤–æ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é  
  *(PENDING ‚Üí CONFIRMED/CANCELLED, —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π –ø—Ä–∏ —Å–±–æ–µ)*
- ‚ôªÔ∏è –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (`requestId`)
- ‚è±Ô∏è –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø–∞—É–∑–æ–π –∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≤—ã–±–æ—Ä—É –Ω–æ–º–µ—Ä–∞ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `timesBooked`, –∑–∞—Ç–µ–º –ø–æ `id`)
- üßë‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ—Ç–µ–ª–µ–π –∏ –Ω–æ–º–µ—Ä–æ–≤ (CRUD)
- üìä –ê–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–æ–≤ (`timesBooked`)
- üîó –°–∫–≤–æ–∑–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ `X-Correlation-Id`

---

## üß© –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Java 17+**
- **Maven 3.9+**

---

## üèóÔ∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å Eureka Server**
   ```bash
   mvn -pl eureka-server spring-boot:run
–ó–∞–ø—É—Å—Ç–∏—Ç—å API Gateway

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
mvn -pl api-gateway spring-boot:run
–ó–∞–ø—É—Å—Ç–∏—Ç—å Hotel –∏ Booking Service (–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö)

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
mvn -pl hotel-service spring-boot:run
mvn -pl booking-service spring-boot:run
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ Eureka:
‚û°Ô∏è http://localhost:8761

# üîë –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JWT

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á HMAC**.  
–°–µ–∫—Ä–µ—Ç –∑–∞–¥–∞—ë—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ–º `security.jwt.secret`  
(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `dev-secret-please-change`) –≤ —Ñ–∞–π–ª–∞—Ö:

- `api-gateway/src/main/resources/application.yml`
- `hotel-service/src/main/resources/application.yml`
- `booking-service/src/main/resources/application.yml`

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞:**  
> –∑–∞–º–µ–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç –∏/–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **OAuth2 / Keycloak** –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—á–µ—Ä–µ–∑ Gateway: –ø–æ—Ä—Ç `8080`)

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST http://localhost:8080/auth/register \
  -H 'Content-Type: application/json' \
  -d '{"username":"user1","password":"pass"}'
  2. –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT
TOKEN=$(curl -s -X POST http://localhost:8080/auth/login \
  -H 'Content-Type: application/json' \
  -d '{"username":"user1","password":"pass"}' | jq -r .access_token)

3. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–µ–ª—è –∏ –Ω–æ–º–µ—Ä–∞ (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
curl -X POST http://localhost:8080/hotels \
  -H "Authorization: Bearer $TOKEN" \
  -H 'Content-Type: application/json' \
  -d '{"name":"Hotel A","city":"Moscow","address":"Red Square, 1"}'

curl -X POST http://localhost:8080/rooms \
  -H "Authorization: Bearer $TOKEN" \
  -H 'Content-Type: application/json' \
  -d '{"number":"101","capacity":2,"available":true}'

4. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ –Ω–æ–º–µ—Ä–∞–º
curl -H "Authorization: Bearer $TOKEN" http://localhost:8080/bookings/suggestions

5. –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Å requestId)
curl -X POST http://localhost:8080/bookings \
  -H "Authorization: Bearer $TOKEN" \
  -H 'Content-Type: application/json' \
  -d '{"roomId":1,"startDate":"2025-10-20","endDate":"2025-10-22","requestId":"req-123"}'

6. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
curl -H "Authorization: Bearer $TOKEN" http://localhost:8080/bookings

üß≠ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã (—á–µ—Ä–µ–∑ Gateway)
üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Booking)
–ú–µ—Ç–æ–¥	–≠–Ω–¥–ø–æ–π–Ω—Ç	–û–ø–∏—Å–∞–Ω–∏–µ
POST	/auth/register	–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –∞–¥–º–∏–Ω–∞ ‚Äî "admin": true)
POST	/auth/login	–ü–æ–ª—É—á–µ–Ω–∏–µ JWT-—Ç–æ–∫–µ–Ω–∞
üìÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (Booking)
–ú–µ—Ç–æ–¥	–≠–Ω–¥–ø–æ–π–Ω—Ç	–û–ø–∏—Å–∞–Ω–∏–µ
GET	/bookings	–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
POST	/bookings	–°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (PENDING ‚Üí CONFIRMED / –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)
GET	/bookings/suggestions	–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –Ω–æ–º–µ—Ä–∞–º
GET	/bookings/all	–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Booking, admin)
GET /admin/users
GET /admin/users/{id}
PUT /admin/users/{id}
DELETE /admin/users/{id}

üè® –û—Ç–µ–ª–∏ –∏ –Ω–æ–º–µ—Ä–∞ (Hotel)
–ú–µ—Ç–æ–¥	–≠–Ω–¥–ø–æ–π–Ω—Ç	–û–ø–∏—Å–∞–Ω–∏–µ
GET	/hotels, /hotels/{id}	–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–µ–ª–µ–π
POST/PUT/DELETE	/hotels, /hotels/{id}	CRUD –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
GET	/rooms/{id}	–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–º–µ—Ä–∞
POST/PUT/DELETE	/rooms	CRUD –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
POST	/rooms/{id}/hold	–£–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ (–ø–æ requestId)
POST	/rooms/{id}/confirm	–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è
POST	/rooms/{id}/release	–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /stats/rooms/popular ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–æ–≤

üîÅ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ (@Transactional)

–î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

PENDING ‚Üí (hold –≤ Hotel) ‚Üí CONFIRM ‚Üí CONFIRMED
–ø—Ä–∏ —Å–±–æ–µ ‚Üí RELEASE + CANCELLED


–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ requestId (–ø–æ–≤—Ç–æ—Ä –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

–ü–æ–≤—Ç–æ—Ä—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö WebClient

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ X-Correlation-Id

üóÑÔ∏è –ö–æ–Ω—Å–æ–ª—å H2

–î–æ—Å—Ç—É–ø–Ω–∞ –≤ Hotel Service –ø–æ –∞–¥—Ä–µ—Å—É:
‚û°Ô∏è /h2-console

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω—ã –≤ application.yml —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

üìò Swagger / OpenAPI
–°–µ—Ä–≤–∏—Å	Swagger UI
Booking Service	http://localhost:<booking-port>/swagger-ui.html

Hotel Service	http://localhost:<hotel-port>/swagger-ui.html

Gateway (–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä)	http://localhost:8080/swagger-ui.html
üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

Unit-—Ç–µ—Å—Ç—ã:

HotelAvailabilityTests ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (hold / confirm / release)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:

Booking Service (WebTestClient + WireMock):
BookingHttpIT#createBooking_Http_Success ‚Äî —É—Å–ø–µ—à–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (CONFIRMED)

Hotel Service (MockMvc):
HotelHttpIT#adminCanCreateHotel ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ CRUD
HotelAvailabilityTests, HotelMoreTests ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∑–∞–Ω—è—Ç–æ—Å—Ç—å

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

mvn -q -DskipTests=false test

üöß –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

–£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—É—á–µ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä)

–î–ª—è –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ / –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î

–í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Keycloak, OAuth2)

–£—Å–∏–ª–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:

Circuit Breaker (Resilience4j)

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
